(()=>{"use strict";var t={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},e=document.querySelector(".profile__edit-button"),n=document.querySelector(".profile__plus-button"),r=document.querySelector(".profile__photo"),o=document.forms.profile,i=o.elements.userName,a=o.elements.userJob;function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var c=function(){function t(e,n,r,o,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._data=e,this._templateSelector=n,this._handleOpenPopup=r,this._like=o,this._handleCardLike=this._handleCardLike.bind(this),this._handleDeleteCard=this._handleDeleteCard.bind(this),this._deleteCard=i,this._cardID=e.id,this._cardTemplate=document.querySelector(this._templateSelector).content.cloneNode("true"),this._card=this._cardTemplate.querySelector(".card"),this._cardTitle=this._cardTemplate.querySelector(".card__title"),this._cardLikeCounter=this._cardTemplate.querySelector(".card__like-counter"),this._likeButton=this._cardTemplate.querySelector(".card__like-button"),this._isLiked=e.isLikedByMe,this._delButton=this._cardTemplate.querySelector(".card__trash-button"),this._owner=e.owner,this._cardImage=this._cardTemplate.querySelector(".card__image")}var e,n;return e=t,(n=[{key:"create",value:function(){return this._cardImage.src=this._data.link,this._cardImage.alt=this._data.name,this._cardTitle.textContent=this._data.name,this._cardLikeCounter.textContent=this._data.likes,this._card.id=this._data.id,this._owner||this._delButton.classList.add("card__trash-button_inactive"),this._addCardListeners(this._cardImage,this._data),this._isLiked&&this._likeButton.classList.add("card__like-button_active"),this._cardTemplate}},{key:"_handleCardLike",value:function(){this._like(this._cardID,this._isLiked)}},{key:"renewLikeCounter",value:function(t){this._cardLikeCounter.textContent=t,this._likeButton.classList.toggle("card__like-button_active"),this._isLiked=!this._isLiked}},{key:"_handleDeleteCard",value:function(t){this._deleteCard(this._cardID,t)}},{key:"_addCardListeners",value:function(){this._cardImage.addEventListener("click",this._handleOpenPopup),this._delButton.addEventListener("click",this._handleDeleteCard),this._likeButton.addEventListener("click",this._handleCardLike)}}])&&u(e.prototype,n),t}();function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var l=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._values=e,this._form=n,this._formInputElements=this._form.querySelectorAll(this._values.inputSelector)}var e,n;return e=t,(n=[{key:"_isInvalid",value:function(t){return!t.validity.valid}},{key:"_showInputError",value:function(t,e){var n=this._form.querySelector(".".concat(t.id,"-error"));n.classList.add(this._values.errorClass),n.textContent=e,t.classList.add(this._values.inputErrorClass)}},{key:"_hideInputError",value:function(t){var e=this._form.querySelector(".".concat(t.id,"-error"));e.classList.remove(this._values.errorClass),e.textContent="",t.classList.remove(this._values.inputErrorClass)}},{key:"_toggleSubmitButton",value:function(){var t=this,e=this._form.querySelector(this._values.submitButtonSelector);Array.from(this._form.elements).some((function(e){return t._isInvalid(e)}))?(e.classList.add(this._values.inactiveButtonClass),e.setAttribute("disabled",!0)):(e.classList.remove(this._values.inactiveButtonClass),e.removeAttribute("disabled"))}},{key:"_setEventListeners",value:function(){var t=this;Array.from(this._formInputElements).forEach((function(e){e.addEventListener("input",(function(){t._toggleSubmitButton(),t._isInvalid(e)?t._showInputError(e,e.validationMessage):t._hideInputError(e)}))}))}},{key:"clearValidation",value:function(){var t=this;this._toggleSubmitButton(),Array.from(this._formInputElements).forEach((function(e){t._hideInputError(e)}))}},{key:"enableValidation",value:function(){this._setEventListeners()}}])&&s(e.prototype,n),t}();function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var p=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._popup=document.querySelector(e),this._closeOnEscape=this._closeOnEscape.bind(this),this._closeOnOverlay=this._closeOnOverlay.bind(this),this._handleClosePopupButton=this._handleClosePopupButton.bind(this)}var e,n;return e=t,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._closeOnEscape)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._closeOnEscape)}},{key:"_handleClosePopupButton",value:function(t){t.target.classList.contains("popup__close-button")&&this.close()}},{key:"_closeOnOverlay",value:function(t){t.currentTarget===t.target&&this.close()}},{key:"_closeOnEscape",value:function(t){"Escape"===t.key&&this.close()}},{key:"setEventListeners",value:function(t){this._popup.addEventListener("click",this._closeOnOverlay),this._popup.addEventListener("click",this._handleClosePopupButton)}}])&&f(e.prototype,n),t}();function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function _(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){y(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function m(t,e,n){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=O(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function b(t,e){return(b=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(t,e){return!e||"object"!==h(e)&&"function"!=typeof e?k(t):e}function k(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function O(t){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var w=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&b(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=O(r);if(o){var n=O(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return g(this,t)});function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t))._submit=e,n._popupForm=document.querySelector(t).querySelector(".form"),n._handleFormSubmit=n._handleFormSubmit.bind(k(n)),n.setEventListeners(),n._formButton=n._popupForm.querySelector(".form__submit-button"),n._formButtonText=n._formButton.textContent,n}return e=a,(n=[{key:"form",value:function(){return this._popupForm}},{key:"_getInputValues",value:function(t){return Array.from(t.querySelectorAll(".form__input")).reduce((function(t,e){return _(_({},t),{},y({},e.name,e.value))}),{})}},{key:"_handleFormSubmit",value:function(t){t.preventDefault();var e=this._getInputValues(this._popupForm);this._submit(e),this.close()}},{key:"toggleButtonState",value:function(){this._formButtonText===this._formButton.textContent?this._formButton.textContent="Сохранение...":this._formButton.textContent=this._formButtonText}},{key:"close",value:function(){this._popupForm.reset(),m(O(a.prototype),"close",this).call(this)}},{key:"setEventListeners",value:function(){this._popupForm.addEventListener("submit",this._handleFormSubmit),m(O(a.prototype),"setEventListeners",this).call(this)}}])&&v(e.prototype,n),a}(p);function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function S(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function E(t,e){return(E=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function L(t,e){return!e||"object"!==C(e)&&"function"!=typeof e?j(t):e}function j(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function P(t,e,n){return(P="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=I(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function I(t){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var B=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&E(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=I(r);if(o){var n=I(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return L(this,t)});function a(t){var e,n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t))._popup=document.querySelector(t),n._popupPhotoImage=n._popup.querySelector(".popup__photo"),n._popupPhotoTitle=n._popup.querySelector(".popup__title_content_photo"),P((e=j(n),I(a.prototype)),"setEventListeners",e).call(e),n}return e=a,(n=[{key:"open",value:function(t){var e=t.name,n=t.link;this._popupPhotoImage.src=n,this._popupPhotoImage.alt=e,this._popupPhotoTitle.textContent=e,P(I(a.prototype),"open",this).call(this)}}])&&S(e.prototype,n),a}(p);function T(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var q=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=document.querySelector(e)}var e,n;return e=t,(n=[{key:"addItem",value:function(t){this._container.append(t)}},{key:"addItemToTop",value:function(t){this._container.prepend(t)}}])&&T(e.prototype,n),t}();function R(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var x=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._userNameElement=document.querySelector(e),this._userJobElement=document.querySelector(n),this._userAvatarElement=document.querySelector(r)}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(t){return{userName:"".concat(t.name),userJob:"".concat(t.about),userAvatar:"".concat(t.avatar),userID:"".concat(t._id)}}},{key:"setUserInfo",value:function(t){var e=t.userName,n=t.userJob,r=t.userAvatar,o=t.userID;this._userNameElement.textContent=e,this._userJobElement.textContent=n,this._userAvatarElement.style.backgroundImage="url(".concat(r,")"),this._userNameElement.id=o}}])&&R(e.prototype,n),t}();function D(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function A(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t))}var N=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._url=e,this._token=r,this._groupId=n}var e,n;return e=t,(n=[{key:"getInitialCards",value:function(){return fetch("".concat(this._url,"/v1/cohort-").concat(this._groupId,"/cards"),{headers:{authorization:this._token}}).then(A)}},{key:"getCurrentUser",value:function(){return fetch("".concat(this._url,"/v1/cohort-").concat(this._groupId,"/users/me"),{headers:{authorization:this._token}}).then(A)}},{key:"setCurrentUser",value:function(t){return fetch("".concat(this._url,"/v1/cohort-").concat(this._groupId,"/users/me"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:t.userName,about:t.userJob})}).then(A)}},{key:"addNewCard",value:function(t){return fetch("".concat(this._url,"/v1/cohort-").concat(this._groupId,"/cards"),{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,link:t.link})}).then(A)}},{key:"setCardLike",value:function(t){return fetch("".concat(this._url,"/v1/cohort-").concat(this._groupId,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:this._token,"Content-Type":"application/json"}}).then(A)}},{key:"removeCardLike",value:function(t){return fetch("".concat(this._url,"/v1/cohort-").concat(this._groupId,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:this._token,"Content-Type":"application/json"}}).then(A)}},{key:"removeCard",value:function(t){return fetch("".concat(this._url,"/v1/cohort-").concat(this._groupId,"/cards/").concat(t),{method:"DELETE",headers:{authorization:this._token,"Content-Type":"application/json"}}).then(A)}},{key:"avatarChange",value:function(t){return fetch("".concat(this._url,"/v1/cohort-").concat(this._groupId,"/users/me/avatar/"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(A)}}])&&D(e.prototype,n),t}();function U(t){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function F(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function J(t,e,n){return(J="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=H(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function V(t,e){return(V=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function z(t,e){return!e||"object"!==U(e)&&"function"!=typeof e?M(t):e}function M(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function H(t){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var $=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&V(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=H(r);if(o){var n=H(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return z(this,t)});function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t))._popup=document.querySelector(t),n._popupButton=n._popup.querySelector(".popup__approve-button"),n._deleteCard=e,n._cardID="",n._evt="",n._handleButtonClick=n._handleButtonClick.bind(M(n)),n._setEventListeners(),n}return e=a,(n=[{key:"open",value:function(t,e){this._evt=e,this._cardID=t,J(H(a.prototype),"open",this).call(this)}},{key:"_handleButtonClick",value:function(){this._deleteCard(this._cardID,this._evt),J(H(a.prototype),"close",this).call(this)}},{key:"_setEventListeners",value:function(){this._popupButton.addEventListener("click",this._handleButtonClick),J(H(a.prototype),"setEventListeners",this).call(this)}}])&&F(e.prototype,n),a}(p);function G(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var K=new N("https://mesto.nomoreparties.co",22,"a117537f-0d63-496d-890f-35a7461e03ea"),Q=new x(".profile__name",".profile__job",".profile__photo"),W=new $(".popup_content_delete-card",(function(t,e){K.removeCard(t).then((function(t){e.target.closest("li").remove(),W.close()})).catch((function(t){return console.log(t)}))})),X=new w(".popup_content_avatar-renew",(function(t){X.toggleButtonState(),K.avatarChange(t.link).then((function(t){ot()})).catch((function(t){console.log("Произошла ошибка ".concat(t))})).finally((function(){return X.toggleButtonState()}))})),Y=new w(".popup_content_card-add",(function(t){Y.toggleButtonState(),t.owner=!0,K.addNewCard(t).then((function(e){t.id=e._id,it.addItemToTop(at(t))})).catch((function(t){return console.log(t)})).finally((function(){Y.toggleButtonState()}))})),Z=new w(".popup_content_profile-edit",(function(t){var e;e=t,Z.toggleButtonState(),K.setCurrentUser(e).then((function(t){return ot()})).catch((function(t){return console.log(t)})).finally((function(){return Z.toggleButtonState()}))})),tt=new B(".popup_content_photo"),et=new l(t,Z.form()),nt=new l(t,Y.form()),rt=new l(t,X.form());function ot(){K.getCurrentUser().then((function(t){return Q.getUserInfo(t)})).then((function(t){return Q.setUserInfo(t)})).catch((function(t){return console.log(t)}))}et.enableValidation(),nt.enableValidation(),rt.enableValidation();var it=new q(".cards__list");function at(t){var e=new c(t,"#card",(function(t){var e={link:"".concat(t.target.src),name:"".concat(t.path[1].querySelector(".card__title").textContent)};tt.open(e)}),(function(t,n){n?K.removeCardLike(t).then((function(t){return t.likes.length})).then((function(t){e.renewLikeCounter(t)})).catch((function(t){return console.log(t)})):K.setCardLike(t).then((function(t){return t.likes.length})).then((function(t){e.renewLikeCounter(t)})).catch((function(t){return console.log(t)}))}),(function(t,e){W.open(t,e)}));return e.create()}Promise.all([K.getCurrentUser(),K.getInitialCards()]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}}(e,n)||function(t,e){if(t){if("string"==typeof t)return G(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?G(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1],a=[{name:"",link:"",id:"",likes:0,isLikedByMe:!1,owner:!1}];i.forEach((function(t){a.name=t.name,a.link=t.link,a.id=t._id,a.likes=t.likes.length,a.isLikedByMe=t.likes.some((function(t){return t._id===o._id})),a.owner=t.owner._id===o._id,it.addItem(at(a))}))})),ot(),e.addEventListener("click",(function(){K.getCurrentUser().then((function(t){return Q.getUserInfo(t)})).then((function(t){i.value=t.userName,a.value=t.userJob,Z.open(),et.clearValidation()})).catch((function(t){return console.log(t)}))})),n.addEventListener("click",(function(){nt.clearValidation(),Y.open()})),r.addEventListener("click",(function(){rt.clearValidation(),X.open()}))})();